# API Usage Guide

This document describes how to use the Payment API endpoints.

## Base URL

When running locally:
- HTTP: `http://localhost:5000`
- HTTPS: `https://localhost:5001`

## Endpoints

### Create Payment

Creates a new payment with idempotency support.

**Request:**
```http
POST /api/payments
Content-Type: application/json

{
  "amount": 100.00,
  "currency": "USD",
  "idempotencyKey": "unique-request-id-123"
}
```

**Response (201 Created):**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "amount": 100.00,
  "currency": "USD",
  "status": "Pending",
  "createdAt": "2025-01-27T12:00:00Z",
  "idempotencyKey": "unique-request-id-123"
}
```

**Response Headers:**
```
Location: /api/payments/550e8400-e29b-41d4-a716-446655440000
```

### Get Payment

Retrieves a payment by its ID.

**Request:**
```http
GET /api/payments/{id}
```

**Response (200 OK):**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "amount": 100.00,
  "currency": "USD",
  "status": "Pending",
  "createdAt": "2025-01-27T12:00:00Z",
  "idempotencyKey": "unique-request-id-123"
}
```

**Response (404 Not Found):**
Payment with the specified ID was not found.

## Request/Response Models

### Payment Object

| Field | Type | Description |
|-------|------|-------------|
| `id` | GUID | Unique payment identifier (generated by server) |
| `amount` | decimal | Payment amount (required) |
| `currency` | string | 3-letter currency code, e.g., "USD", "EUR" (required) |
| `status` | string | Payment status: "Pending", "Completed", "Failed" |
| `createdAt` | datetime | UTC timestamp when payment was created |
| `idempotencyKey` | string | Client-provided key for idempotency (required) |

## Idempotency Usage

To ensure safe retries, always include an `idempotencyKey` in your requests:

```bash
# First request
curl -X POST https://localhost:5001/api/payments \
  -H "Content-Type: application/json" \
  -d '{
    "amount": 50.00,
    "currency": "EUR",
    "idempotencyKey": "order-12345-payment"
  }'

# Retry with same idempotencyKey returns the same payment
curl -X POST https://localhost:5001/api/payments \
  -H "Content-Type: application/json" \
  -d '{
    "amount": 50.00,
    "currency": "EUR",
    "idempotencyKey": "order-12345-payment"
  }'
```

Both requests will return the same payment (same ID, same createdAt).

## Error Codes

| HTTP Status | Description |
|-------------|-------------|
| 201 | Payment created successfully |
| 200 | Payment retrieved successfully |
| 404 | Payment not found |
| 409 | Conflict (e.g., idempotency key collision with different payload) |
| 500 | Internal server error |

## Best Practices

1. **Always use idempotency keys**: Generate unique keys per operation (e.g., UUID, order ID + action).

2. **Keep idempotency keys unique per operation**: Use `order-123-payment` not just `order-123`.

3. **Retry safely**: If you receive a network timeout, retry with the same idempotency key.

4. **Store idempotency keys**: Keep track of keys you've used to avoid accidental reuse.

## OpenAPI/Swagger

When running in development mode, the OpenAPI specification is available at:
```
GET /openapi/v1.json
```
